# 故障排查指南（示例）

## 1. 安装失败

### 1.1 常见原因

- 未以管理员权限运行
- 依赖离线包缺失或损坏（.NET Framework / VC++ 运行库）
- 组件安装包未支持静默参数或返回非 0/3010/1641 的退出码
- 被安全软件拦截（需做白名单与签名交付）

### 1.2 排查步骤

1. 运行 `doctor` 查看运行环境

```powershell
.\xiaohai-bootstrapper.exe --manifest .\bundle-manifest.json doctor
```

2. 确认 `bundle-manifest.json` 的 `installer.path` 指向的文件在 `payload/` 中真实存在
3. 检查各安装程序退出码（bootstrapper 会在错误中回显 stdout/stderr）

## 2. 桌面仍出现其他组件图标

- 在清单中为对应模块补充 `remove_desktop_shortcuts`（按快捷方式文件名，不含 .lnk）
- 如组件安装器会在首次启动后再次生成快捷方式，建议在“首次启动脚本/修复任务”中二次清理

## 3. 统一入口看不到应用

- 检查 `%ProgramData%\\XiaoHaiAssistant\\plugins\\` 下是否生成插件 json
- 检查插件 json 的 `exe` 路径是否可在安装目录下解析到真实可执行文件

## 4. 单点登录/IPC 异常

- 当前 IPC 为本机回环 TCP，应用侧需读取 `XIAOHAI_IPC_ADDR` 环境变量并按 JSON 行协议调用
- 企业交付建议升级为 Named Pipe + ACL，以提升安全性

